<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Create Issue</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
          crossorigin="anonymous">

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>
<body>

<nav th:insert="~{fragments/general/nav-bar ::navBar }"></nav>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-9">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Create Issue</h4>
                </div>

                <div class="card-body">
                    <form th:action="@{/libra/issues/create}"
                          th:object="${form}"
                          method="post">

                        <input type="hidden"
                               th:name="${_csrf.parameterName}"
                               th:value="${_csrf.token}" />

                        <div class="alert alert-danger"
                             th:if="${#fields.hasErrors('*')}">
                            Please fix the errors below
                        </div>

                        <input type="hidden" th:field="*{userCreatedId}"/>

                        <div class="mb-3" th:if="${form.posId != null}">
                            <label class="form-label">POS</label>

                            <input type="hidden" th:field="*{posId}"/>

                            <input class="form-control"
                                   th:value="${selectedPos != null ? selectedPos.name : form.posId}"
                                   readonly/>
                            <div class="invalid-feedback" th:errors="*{posId}"></div>
                        </div>

                        <div class="mb-3" th:if="${form.posId == null}">
                            <label class="form-label">POS</label>
                            <select class="form-select"
                                    th:field="*{posId}"
                                    th:classappend="${#fields.hasErrors('posId')} ? 'is-invalid'">
                                <option value="">-- Select POS --</option>
                                <option th:each="p : ${positions}"
                                        th:value="${p.id}"
                                        th:text="${p.name}">
                                </option>
                            </select>
                            <div class="invalid-feedback" th:errors="*{posId}"></div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">General Type</label>
                            <select class="form-select"
                                    th:field="*{generalType}"
                                    th:classappend="${#fields.hasErrors('generalType')} ? 'is-invalid'">
                                <option value="">-- Select general type --</option>
                                <option th:each="genType : ${generalTypes}"
                                        th:value="${genType}"
                                        th:text="${genType}">GENERAL_TYPE</option>
                            </select>
                            <div class="invalid-feedback" th:errors="*{generalType}"></div>
                        </div>

<!--                        &lt;!&ndash; Issue Type &ndash;&gt;-->
<!--                        <div class="mb-3">-->
<!--                            <label class="form-label">Issue Type</label>-->
<!--                            <select class="form-select"-->
<!--                                    th:field="*{type}"-->
<!--                                    th:classappend="${#fields.hasErrors('type')} ? 'is-invalid'">-->
<!--                                <option value="">&#45;&#45; Select type &#45;&#45;</option>-->
<!--                                <option th:each="t : ${types}"-->
<!--                                        th:value="${t.id}"-->
<!--                                        th:text="${t.name}">-->
<!--                                </option>-->
<!--                            </select>-->
<!--                            <div class="invalid-feedback" th:errors="*{type}"></div>-->
<!--                        </div>-->

                        <!-- Problem title -->
                        <div class="mb-3">
                            <label class="form-label">Problem Title</label>
                            <input type="text"
                                   class="form-control"
                                   th:field="*{problemTitle}"
                                   th:classappend="${#fields.hasErrors('problemTitle')} ? 'is-invalid'">
                            <div class="invalid-feedback" th:errors="*{problemTitle}"></div>
                        </div>

                        <!-- Priority + Status -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Priority (1-5)</label>
                                <select class="form-select"
                                        th:field="*{priority}"
                                        th:classappend="${#fields.hasErrors('priority')} ? 'is-invalid'">
                                    <option value="">-- Select priority --</option>
                                    <option th:each="p : ${priorities}"
                                            th:value="${p}"
                                            th:text="${p}">
                                    </option>
                                </select>
                                <div class="invalid-feedback" th:errors="*{priority}"></div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label">Status</label>
                                <select class="form-select"
                                        th:field="*{status}"
                                        th:classappend="${#fields.hasErrors('status')} ? 'is-invalid'">
                                    <option value="">-- Select status --</option>
                                    <option th:each="s : ${statuses}"
                                            th:value="${s.id}"
                                            th:text="${s.status}">
                                    </option>
                                </select>
                                <div class="invalid-feedback" th:errors="*{status}"></div>
                            </div>
                        </div>

                        <!-- Assigned user + assigned date -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Assign To (optional)</label>
                                <select class="form-select"
                                        th:field="*{assignedToId}">
                                    <option value="">-- Not assigned --</option>
                                    <option th:each="u : ${users}"
                                            th:value="${u.id}"
                                            th:text="${u.login}">
                                    </option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label">Assigned Date (optional)</label>
                                <input type="date"
                                       class="form-control"
                                       th:field="*{assignedDate}"
                                       th:classappend="${#fields.hasErrors('assignedDate')} ? 'is-invalid'">
                                <div class="invalid-feedback" th:errors="*{assignedDate}"></div>
                            </div>
                        </div>

                        <!-- Memo -->
                        <div class="mb-3">
                            <label class="form-label">Memo (optional)</label>
                            <input type="text"
                                   class="form-control"
                                   th:field="*{memo}">
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label class="form-label">Description (optional)</label>
                            <textarea class="form-control"
                                      rows="4"
                                      th:field="*{description}"></textarea>
                        </div>

                        <!-- creation/modify dates -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Creation Date</label>
                                <input type="date"
                                       class="form-control"
                                       th:field="*{creationDate}"
                                       th:classappend="${#fields.hasErrors('creationDate')} ? 'is-invalid'">
                                <div class="invalid-feedback" th:errors="*{creationDate}"></div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label">Modify Date</label>
                                <input type="date"
                                       class="form-control"
                                       th:field="*{modifyDate}"
                                       th:classappend="${#fields.hasErrors('modifyDate')} ? 'is-invalid'">
                                <div class="invalid-feedback" th:errors="*{modifyDate}"></div>
                            </div>
                        </div>

                        <!-- Solution -->
                        <div class="mb-4">
                            <label class="form-label">Solution (optional)</label>
                            <textarea class="form-control"
                                      rows="3"
                                      th:field="*{solution}"></textarea>
                        </div>

                        <div class="d-flex justify-content-end gap-2">
                            <a th:href="@{/libra/home}" class="btn btn-secondary">
                                Cancel
                            </a>
                            <button type="submit" class="btn btn-success">
                                Create Issue
                            </button>
                        </div>

                    </form>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
